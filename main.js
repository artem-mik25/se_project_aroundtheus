(()=>{"use strict";var e={960:(e,t,s)=>{e.exports=s.p+"assets/df100efc54d4645073d7.jpg"},291:(e,t,s)=>{e.exports=s.p+"assets/8edfe6cd78e39aafc871.jpg"},822:(e,t,s)=>{e.exports=s.p+"assets/44e6fede87f55e5327cc.jpg"},328:(e,t,s)=>{e.exports=s.p+"assets/e463b225f0897d749d63.jpg"},705:(e,t,s)=>{e.exports=s.p+"assets/70aac30a40409c4dbc71.jpg"},561:(e,t,s)=>{e.exports=s.p+"assets/2e37fd0c260a298af732.jpg"}},t={};function s(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,s),i.exports}s.p="/",(()=>{class e{constructor(e,t,s,n){this._data=e,this._name=e.name,this._link=e.link,this._cardId=e._id,this._cardSelector=t,this._handleImageClick=s,this._handleDeleteClick=n,this._element=this._getTemplate(),this._likeButton=this._element.querySelector(".card__like-button"),this._cardImage=this._element.querySelector(".card__image"),this._deleteButton=this._element.querySelector(".card__delete-button"),this._cardTitle=this._element.querySelector(".card__title"),this._setEventListeners()}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}_setEventListeners(){this._cardImage.addEventListener("click",(()=>{this._handleImageClick(this._name,this._link)})),this._likeButton.addEventListener("click",(()=>{this._handleLikeButton()})),this._deleteButton.addEventListener("click",(()=>{this._handleDeleteClick(this._cardId,this._element)})),this._cardImage.addEventListener("error",(()=>{this._cardImage.src="https://placekitten.com/400/300",this._cardImage.alt="Fallback image"}))}_handleLikeButton(){this._likeButton.classList.toggle("liked")}getView(){return this._cardImage.src=this._link,this._cardImage.alt=this._name,this._cardTitle.textContent=this._name,this._element}}class t{constructor(e,t){this._config=e,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._config.inputSelector)),this._buttonElement=this._formElement.querySelector(this._config.submitButtonSelector)}_showInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);t?(e.classList.add(this._config.inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._config.errorClass)):console.error("Error Element Not Found:",`#${e.id}-error`)}_hideInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);t?(e.classList.remove(this._config.inputErrorClass),t.textContent="",t.classList.remove(this._config.errorClass)):console.error("Error Element Not Found:",`#${e.id}-error`)}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._config.inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.classList.remove(this._config.inactiveButtonClass),this._buttonElement.disabled=!1)}_setEventListeners(){this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))})),this._formElement.addEventListener("reset",(()=>{this._inputList.forEach((e=>{this._hideInputError(e)})),setTimeout((()=>{this._toggleButtonState()}),1)}))}enableValidation(){this._setEventListeners()}}class n{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popup.addEventListener("mousedown",(e=>{(e.target.classList.contains("modal__close")||e.target===this._popup)&&this.close()}))}}class r extends n{constructor(e,t){super(e),this._handleFormSubmit=t,this._formElement=this._popup.querySelector(".modal__form"),this._inputList=Array.from(this._formElement.querySelectorAll(".modal__input")),this._submitButton=this._formElement.querySelector(".modal__button"),this._defaultSubmitButtonText=this._submitButton.textContent}_getInputValues(){const e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),e}open(){super.open(),this._formElement.reset()}renderLoading(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Saving...";this._submitButton.textContent=e?t:this._defaultSubmitButtonText}setEventListeners(){super.setEventListeners(),this._formElement.addEventListener("submit",(e=>{e.preventDefault(),this.renderLoading(!0),this._handleFormSubmit(this._getInputValues())}))}close(){super.close(),this._formElement.reset(),this.renderLoading(!1)}}const i=[{_id:"1",name:"Yosemite Valley",link:s(561)},{_id:"2",name:"Lake Louise",link:s(822)},{_id:"3",name:"Bald Mountains",link:s(960)},{_id:"4",name:"Latemar",link:s(328)},{_id:"5",name:"Vanoise National Park",link:s(705)},{_id:"6",name:"Lago di Braies",link:s(291)}],o=(document.querySelector(".cards__list"),document.querySelector("#profile__edit-button")),a=document.querySelector(".profile__add-button"),l=document.querySelector(".profile__avatar-container");var d;document.forms["profile-form"],document.forms["card-form"],document.forms["avatar-form"],d={inputSelector:".modal__input",submitButtonSelector:".modal__button",inactiveButtonClass:"modal__button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},Array.from(document.querySelectorAll("form")).forEach((e=>{new t(d,e).enableValidation()}));const c=new class{constructor(e){let{nameSelector:t,jobSelector:s,avatarSelector:n}=e;this._nameElement=document.querySelector(t),this._jobElement=document.querySelector(s),this._avatarElement=document.querySelector(n)}getUserInfo(){return{name:this._nameElement.textContent,job:this._jobElement.textContent,avatar:this._avatarElement.src}}setUserInfo(e){let{name:t,job:s,avatar:n}=e;t&&(this._nameElement.textContent=t),s&&(this._jobElement.textContent=s),n&&(this._avatarElement.src=n,this._avatarElement.alt=`Avatar of ${t||this._nameElement.textContent}`,this._avatarElement.onerror=()=>{this._avatarElement.src="https://placekitten.com/150/150",this._avatarElement.alt="Fallback avatar image"})}}({nameSelector:"#profile-title",jobSelector:"#profile-description",avatarSelector:".profile__image"}),m=new r("#profile-edit-modal",(e=>{m.renderLoading(!0,"Saving..."),setTimeout((()=>{c.setUserInfo({name:e.title,job:e.description}),m.renderLoading(!1),m.close()}),2e3)}));m.setEventListeners(),o.addEventListener("click",(()=>{const e=c.getUserInfo();document.querySelector("#profile-title-input").value=e.name,document.querySelector("#profile-description-input").value=e.job,m.open()}));const _=new class extends n{constructor(e){super(e),this._imageElement=this._popup.querySelector(".modal__image"),this._captionElement=this._popup.querySelector(".modal__caption")}open(e){let{name:t,link:s}=e;s.trim()&&t.trim()?(this._imageElement.src=s,this._imageElement.alt=`Image of ${t}`,this._captionElement.textContent=t,super.open()):console.error("Invalid image data: missing name or link")}}("#image-preview-modal");_.setEventListeners();const u=(e,t)=>{_.open({name:e,link:t})},h=new class extends n{constructor(e,t){let{handleFormSubmit:s}=t;super(e),this._handleFormSubmit=s,this._form=this._popup.querySelector(".modal__form")}open(e,t){this._cardId=e,this._cardElement=t,super.open()}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._cardId,this._cardElement)}))}}("#confirm-delete-modal",{handleFormSubmit:(e,t)=>{t.remove(),h.close()}});h.setEventListeners();const p=t=>new e(t,"#card-template",u,((e,t)=>{h.open(e,t)})).getView(),E=new class{constructor(e,t){let{items:s,renderer:n}=e;this._renderedItems=s,this._renderer=n,this._container=document.querySelector(t)}renderItems(){this._renderedItems.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({items:i,renderer:e=>{const t=p(e);E.addItem(t)}},".cards__list");E.renderItems();const v=new r("#add-place-modal",(e=>{v.renderLoading(!0,"Saving...");const t={name:e.title,link:e.image};if(!t.name.trim()||!t.link.trim())return alert("Please fill out both the name and image URL fields."),void v.renderLoading(!1);setTimeout((()=>{const e=p(t);E.addItem(e),v.renderLoading(!1),v.close()}),2e3)}));v.setEventListeners(),a.addEventListener("click",(()=>{v.open()}));const f=new r("#avatar-edit-modal",(e=>{f.renderLoading(!0,"Saving...");const t=e.avatar;setTimeout((()=>{c.setUserInfo({avatar:t}),f.renderLoading(!1),f.close()}),2e3)}));f.setEventListeners(),l.addEventListener("click",(()=>{const e=c.getUserInfo();document.querySelector("#avatar-input").value=e.avatar,f.open()}))})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoicVpBQ0lBLEVBQTJCLENBQUMsRUFHaEMsU0FBU0MsRUFBb0JDLEdBRTVCLElBQUlDLEVBQWVILEVBQXlCRSxHQUM1QyxRQUFxQkUsSUFBakJELEVBQ0gsT0FBT0EsRUFBYUUsUUFHckIsSUFBSUMsRUFBU04sRUFBeUJFLEdBQVksQ0FHakRHLFFBQVMsQ0FBQyxHQU9YLE9BSEFFLEVBQW9CTCxHQUFVSSxFQUFRQSxFQUFPRCxRQUFTSixHQUcvQ0ssRUFBT0QsT0FDZixDQ3RCQUosRUFBb0JPLEVBQUksSSxNQ0NULE1BQU1DLEVBQ25CQyxXQUFBQSxDQUFZQyxFQUFNQyxFQUFjQyxFQUFrQkMsR0FDaERDLEtBQUtDLE1BQVFMLEVBQ2JJLEtBQUtFLE1BQVFOLEVBQUtPLEtBQ2xCSCxLQUFLSSxNQUFRUixFQUFLUyxLQUNsQkwsS0FBS00sUUFBVVYsRUFBS1csSUFDcEJQLEtBQUtRLGNBQWdCWCxFQUNyQkcsS0FBS1Msa0JBQW9CWCxFQUN6QkUsS0FBS1UsbUJBQXFCWCxFQUUxQkMsS0FBS1csU0FBV1gsS0FBS1ksZUFDckJaLEtBQUthLFlBQWNiLEtBQUtXLFNBQVNHLGNBQWMsc0JBQy9DZCxLQUFLZSxXQUFhZixLQUFLVyxTQUFTRyxjQUFjLGdCQUM5Q2QsS0FBS2dCLGNBQWdCaEIsS0FBS1csU0FBU0csY0FBYyx3QkFDakRkLEtBQUtpQixXQUFhakIsS0FBS1csU0FBU0csY0FBYyxnQkFFOUNkLEtBQUtrQixvQkFDUCxDQUdBTixZQUFBQSxHQU1FLE9BTG9CTyxTQUNqQkwsY0FBY2QsS0FBS1EsZUFDbkJZLFFBQVFOLGNBQWMsU0FDdEJPLFdBQVUsRUFHZixDQUdBSCxrQkFBQUEsR0FFRWxCLEtBQUtlLFdBQVdPLGlCQUFpQixTQUFTLEtBQ3hDdEIsS0FBS1Msa0JBQWtCVCxLQUFLRSxNQUFPRixLQUFLSSxNQUFNLElBSWhESixLQUFLYSxZQUFZUyxpQkFBaUIsU0FBUyxLQUN6Q3RCLEtBQUt1QixtQkFBbUIsSUFJMUJ2QixLQUFLZ0IsY0FBY00saUJBQWlCLFNBQVMsS0FDM0N0QixLQUFLVSxtQkFBbUJWLEtBQUtNLFFBQVNOLEtBQUtXLFNBQVMsSUFJdERYLEtBQUtlLFdBQVdPLGlCQUFpQixTQUFTLEtBQ3hDdEIsS0FBS2UsV0FBV1MsSUFBTSxrQ0FDdEJ4QixLQUFLZSxXQUFXVSxJQUFNLGdCQUFnQixHQUUxQyxDQUdBRixpQkFBQUEsR0FDRXZCLEtBQUthLFlBQVlhLFVBQVVDLE9BQU8sUUFDcEMsQ0FHQUMsT0FBQUEsR0FJRSxPQUhBNUIsS0FBS2UsV0FBV1MsSUFBTXhCLEtBQUtJLE1BQzNCSixLQUFLZSxXQUFXVSxJQUFNekIsS0FBS0UsTUFDM0JGLEtBQUtpQixXQUFXWSxZQUFjN0IsS0FBS0UsTUFDNUJGLEtBQUtXLFFBQ2QsRUNoRWEsTUFBTW1CLEVBQ25CbkMsV0FBQUEsQ0FBWW9DLEVBQVFDLEdBQ2xCaEMsS0FBS2lDLFFBQVVGLEVBQ2YvQixLQUFLa0MsYUFBZUYsRUFDcEJoQyxLQUFLbUMsV0FBYUMsTUFBTUMsS0FBS3JDLEtBQUtrQyxhQUFhSSxpQkFBaUJ0QyxLQUFLaUMsUUFBUU0sZ0JBQzdFdkMsS0FBS3dDLGVBQWlCeEMsS0FBS2tDLGFBQWFwQixjQUFjZCxLQUFLaUMsUUFBUVEscUJBQ3JFLENBRUFDLGVBQUFBLENBQWdCQyxHQUNkLE1BQU1DLEVBQWU1QyxLQUFLa0MsYUFBYXBCLGNBQWMsSUFBSTZCLEVBQWFFLFlBQ2pFRCxHQUlMRCxFQUFhakIsVUFBVW9CLElBQUk5QyxLQUFLaUMsUUFBUWMsaUJBQ3hDSCxFQUFhZixZQUFjYyxFQUFhSyxrQkFDeENKLEVBQWFsQixVQUFVb0IsSUFBSTlDLEtBQUtpQyxRQUFRZ0IsYUFMdENDLFFBQVFDLE1BQU0sMkJBQTRCLElBQUlSLEVBQWFFLFdBTS9ELENBRUFPLGVBQUFBLENBQWdCVCxHQUNkLE1BQU1DLEVBQWU1QyxLQUFLa0MsYUFBYXBCLGNBQWMsSUFBSTZCLEVBQWFFLFlBQ2pFRCxHQUlMRCxFQUFhakIsVUFBVTJCLE9BQU9yRCxLQUFLaUMsUUFBUWMsaUJBQzNDSCxFQUFhZixZQUFjLEdBQzNCZSxFQUFhbEIsVUFBVTJCLE9BQU9yRCxLQUFLaUMsUUFBUWdCLGFBTHpDQyxRQUFRQyxNQUFNLDJCQUE0QixJQUFJUixFQUFhRSxXQU0vRCxDQUVBUyxtQkFBQUEsQ0FBb0JYLEdBQ2JBLEVBQWFZLFNBQVNDLE1BR3pCeEQsS0FBS29ELGdCQUFnQlQsR0FGckIzQyxLQUFLMEMsZ0JBQWdCQyxFQUl6QixDQUVBYyxnQkFBQUEsR0FDRSxPQUFPekQsS0FBS21DLFdBQVd1QixNQUFLZixJQUFpQkEsRUFBYVksU0FBU0MsT0FDckUsQ0FFQUcsa0JBQUFBLEdBQ00zRCxLQUFLeUQsb0JBQ1B6RCxLQUFLd0MsZUFBZWQsVUFBVW9CLElBQUk5QyxLQUFLaUMsUUFBUTJCLHFCQUMvQzVELEtBQUt3QyxlQUFlcUIsVUFBVyxJQUUvQjdELEtBQUt3QyxlQUFlZCxVQUFVMkIsT0FBT3JELEtBQUtpQyxRQUFRMkIscUJBQ2xENUQsS0FBS3dDLGVBQWVxQixVQUFXLEVBRW5DLENBRUEzQyxrQkFBQUEsR0FDRWxCLEtBQUsyRCxxQkFDTDNELEtBQUttQyxXQUFXMkIsU0FBUW5CLElBQ3RCQSxFQUFhckIsaUJBQWlCLFNBQVMsS0FDckN0QixLQUFLc0Qsb0JBQW9CWCxHQUN6QjNDLEtBQUsyRCxvQkFBb0IsR0FDekIsSUFHSjNELEtBQUtrQyxhQUFhWixpQkFBaUIsU0FBUyxLQUMxQ3RCLEtBQUttQyxXQUFXMkIsU0FBUW5CLElBQ3RCM0MsS0FBS29ELGdCQUFnQlQsRUFBYSxJQUVwQ29CLFlBQVcsS0FDVC9ELEtBQUsyRCxvQkFBb0IsR0FDeEIsRUFBRSxHQUVULENBRUFLLGdCQUFBQSxHQUNFaEUsS0FBS2tCLG9CQUNQLEVDekVhLE1BQU0rQyxFQUNuQnRFLFdBQUFBLENBQVl1RSxHQUNWbEUsS0FBS21FLE9BQVNoRCxTQUFTTCxjQUFjb0QsR0FDckNsRSxLQUFLb0UsZ0JBQWtCcEUsS0FBS29FLGdCQUFnQkMsS0FBS3JFLEtBQ25ELENBR0FzRSxJQUFBQSxHQUNFdEUsS0FBS21FLE9BQU96QyxVQUFVb0IsSUFBSSxnQkFDMUIzQixTQUFTRyxpQkFBaUIsVUFBV3RCLEtBQUtvRSxnQkFDNUMsQ0FHQUcsS0FBQUEsR0FDRXZFLEtBQUttRSxPQUFPekMsVUFBVTJCLE9BQU8sZ0JBQzdCbEMsU0FBU3FELG9CQUFvQixVQUFXeEUsS0FBS29FLGdCQUMvQyxDQUdBQSxlQUFBQSxDQUFnQkssR0FDSSxXQUFkQSxFQUFNQyxLQUNSMUUsS0FBS3VFLE9BRVQsQ0FHQUksaUJBQUFBLEdBRUUzRSxLQUFLbUUsT0FBTzdDLGlCQUFpQixhQUFjbUQsS0FFdkNBLEVBQU1HLE9BQU9sRCxVQUFVbUQsU0FBUyxpQkFDaENKLEVBQU1HLFNBQVc1RSxLQUFLbUUsU0FFdEJuRSxLQUFLdUUsT0FDUCxHQUVKLEVDbENhLE1BQU1PLFVBQXNCYixFQUN6Q3RFLFdBQUFBLENBQVl1RSxFQUFlYSxHQUN6QkMsTUFBTWQsR0FDTmxFLEtBQUtpRixrQkFBb0JGLEVBQ3pCL0UsS0FBS2tDLGFBQWVsQyxLQUFLbUUsT0FBT3JELGNBQWMsZ0JBQzlDZCxLQUFLbUMsV0FBYUMsTUFBTUMsS0FBS3JDLEtBQUtrQyxhQUFhSSxpQkFBaUIsa0JBQ2hFdEMsS0FBS2tGLGNBQWdCbEYsS0FBS2tDLGFBQWFwQixjQUFjLGtCQUNyRGQsS0FBS21GLHlCQUEyQm5GLEtBQUtrRixjQUFjckQsV0FDckQsQ0FHQXVELGVBQUFBLEdBQ0UsTUFBTUMsRUFBYSxDQUFDLEVBSXBCLE9BSEFyRixLQUFLbUMsV0FBVzJCLFNBQVN3QixJQUN2QkQsRUFBV0MsRUFBTW5GLE1BQVFtRixFQUFNQyxLQUFLLElBRS9CRixDQUNULENBR0FmLElBQUFBLEdBQ0VVLE1BQU1WLE9BQ050RSxLQUFLa0MsYUFBYXNELE9BQ3BCLENBR0FDLGFBQUFBLENBQWNDLEdBQXNDLElBQTNCQyxFQUFXQyxVQUFBQyxPQUFBLFFBQUF4RyxJQUFBdUcsVUFBQSxHQUFBQSxVQUFBLEdBQUcsWUFFbkM1RixLQUFLa0YsY0FBY3JELFlBRGpCNkQsRUFDK0JDLEVBRUEzRixLQUFLbUYsd0JBRTFDLENBR0FSLGlCQUFBQSxHQUNFSyxNQUFNTCxvQkFDTjNFLEtBQUtrQyxhQUFhWixpQkFBaUIsVUFBV21ELElBQzVDQSxFQUFNcUIsaUJBQ045RixLQUFLeUYsZUFBYyxHQUNuQnpGLEtBQUtpRixrQkFBa0JqRixLQUFLb0Ysa0JBQWtCLEdBRWxELENBR0FiLEtBQUFBLEdBQ0VTLE1BQU1ULFFBQ052RSxLQUFLa0MsYUFBYXNELFFBQ2xCeEYsS0FBS3lGLGVBQWMsRUFDckIsRUNuREssTUFBTU0sRUFBZSxDQUMxQixDQUNFeEYsSUFBSyxJQUNMSixLQUFNLGtCQUNORSxLQUFNMkYsRUFBUSxNQUVoQixDQUNFekYsSUFBSyxJQUNMSixLQUFNLGNBQ05FLEtBQU0yRixFQUFRLE1BRWhCLENBQ0V6RixJQUFLLElBQ0xKLEtBQU0saUJBQ05FLEtBQU0yRixFQUFRLE1BRWhCLENBQ0V6RixJQUFLLElBQ0xKLEtBQU0sVUFDTkUsS0FBTTJGLEVBQVEsTUFFaEIsQ0FDRXpGLElBQUssSUFDTEosS0FBTSx3QkFDTkUsS0FBTTJGLEVBQVEsTUFFaEIsQ0FDRXpGLElBQUssSUFDTEosS0FBTSxpQkFDTkUsS0FBTTJGLEVBQVEsT0NqQlpDLEdBRFk5RSxTQUFTTCxjQUFjLGdCQUNmSyxTQUFTTCxjQUFjLDBCQUMzQ29GLEVBQW1CL0UsU0FBU0wsY0FBYyx3QkFDMUNxRixFQUFpQmhGLFNBQVNMLGNBQWMsOEJBUXBCaUIsTUFMRlosU0FBU2lGLE1BQU0sZ0JBQ1pqRixTQUFTaUYsTUFBTSxhQUNaakYsU0FBU2lGLE1BQU0sZUFHbkJyRSxFRFdGLENBQ3RCUSxjQUFlLGdCQUNmRSxxQkFBc0IsaUJBQ3RCbUIsb0JBQXFCLHlCQUNyQmIsZ0JBQWlCLDBCQUNqQkUsV0FBWSx3QkNmS2IsTUFBTUMsS0FBS2xCLFNBQVNtQixpQkFBaUIsU0FDN0N3QixTQUFTOUIsSUFDRSxJQUFJRixFQUFjQyxFQUFRQyxHQUNsQ2dDLGtCQUFrQixJQU9oQyxNQUFNcUMsRUFBVyxJQ2pDRixNQUNiMUcsV0FBQUEsQ0FBVzJHLEdBQWdELElBQS9DLGFBQUVDLEVBQVksWUFBRUMsRUFBVyxlQUFFQyxHQUFnQkgsRUFDdkR0RyxLQUFLMEcsYUFBZXZGLFNBQVNMLGNBQWN5RixHQUMzQ3ZHLEtBQUsyRyxZQUFjeEYsU0FBU0wsY0FBYzBGLEdBQzFDeEcsS0FBSzRHLGVBQWlCekYsU0FBU0wsY0FBYzJGLEVBQy9DLENBR0FJLFdBQUFBLEdBQ0UsTUFBTyxDQUNMMUcsS0FBTUgsS0FBSzBHLGFBQWE3RSxZQUN4QmlGLElBQUs5RyxLQUFLMkcsWUFBWTlFLFlBQ3RCa0YsT0FBUS9HLEtBQUs0RyxlQUFlcEYsSUFFaEMsQ0FHQXdGLFdBQUFBLENBQVdDLEdBQXdCLElBQXZCLEtBQUU5RyxFQUFJLElBQUUyRyxFQUFHLE9BQUVDLEdBQVFFLEVBQzNCOUcsSUFBTUgsS0FBSzBHLGFBQWE3RSxZQUFjMUIsR0FDdEMyRyxJQUFLOUcsS0FBSzJHLFlBQVk5RSxZQUFjaUYsR0FFcENDLElBRUYvRyxLQUFLNEcsZUFBZXBGLElBQU11RixFQUMxQi9HLEtBQUs0RyxlQUFlbkYsSUFBTSxhQUFhdEIsR0FBUUgsS0FBSzBHLGFBQWE3RSxjQUdqRTdCLEtBQUs0RyxlQUFlTSxRQUFVLEtBQzVCbEgsS0FBSzRHLGVBQWVwRixJQUFNLGtDQUMxQnhCLEtBQUs0RyxlQUFlbkYsSUFBTSx1QkFBdUIsRUFHdkQsR0RDNEIsQ0FDNUI4RSxhQUFjLGlCQUNkQyxZQUFhLHVCQUNiQyxlQUFnQixvQkFJWlUsRUFBbUIsSUFBSXJDLEVBQWMsdUJBQXdCc0MsSUFDakVELEVBQWlCMUIsZUFBYyxFQUFNLGFBR3JDMUIsWUFBVyxLQUNUc0MsRUFBU1csWUFBWSxDQUFFN0csS0FBTWlILEVBQVNDLE1BQU9QLElBQUtNLEVBQVNFLGNBQzNESCxFQUFpQjFCLGVBQWMsR0FDL0IwQixFQUFpQjVDLE9BQU8sR0FDdkIsSUFBSyxJQUVWNEMsRUFBaUJ4QyxvQkFHakJzQixFQUFrQjNFLGlCQUFpQixTQUFTLEtBQzFDLE1BQU1pRyxFQUFrQmxCLEVBQVNRLGNBQ2pDMUYsU0FBU0wsY0FBYyx3QkFBd0J5RSxNQUFRZ0MsRUFBZ0JwSCxLQUN2RWdCLFNBQVNMLGNBQWMsOEJBQThCeUUsTUFBUWdDLEVBQWdCVCxJQUM3RUssRUFBaUI3QyxNQUFNLElBSXpCLE1BQU1rRCxFQUFhLElFM0RKLGNBQTZCdkQsRUFDMUN0RSxXQUFBQSxDQUFZdUUsR0FDVmMsTUFBTWQsR0FDTmxFLEtBQUt5SCxjQUFnQnpILEtBQUttRSxPQUFPckQsY0FBYyxpQkFDL0NkLEtBQUswSCxnQkFBa0IxSCxLQUFLbUUsT0FBT3JELGNBQWMsa0JBQ25ELENBR0F3RCxJQUFBQSxDQUFJZ0MsR0FBaUIsSUFBaEIsS0FBRW5HLEVBQUksS0FBRUUsR0FBTWlHLEVBQ1pqRyxFQUFLc0gsUUFBV3hILEVBQUt3SCxRQUsxQjNILEtBQUt5SCxjQUFjakcsSUFBTW5CLEVBQ3pCTCxLQUFLeUgsY0FBY2hHLElBQU0sWUFBWXRCLElBQ3JDSCxLQUFLMEgsZ0JBQWdCN0YsWUFBYzFCLEVBQ25DNkUsTUFBTVYsUUFQSnBCLFFBQVFDLE1BQU0sMkNBUWxCLEdGeUNvQyx3QkFDdENxRSxFQUFXN0Msb0JBR1gsTUFBTTdFLEVBQW1CQSxDQUFDSyxFQUFNRSxLQUM5Qm1ILEVBQVdsRCxLQUFLLENBQUVuRSxPQUFNRSxRQUFPLEVBSTNCdUgsRUFBcUIsSUdwRVosY0FBaUMzRCxFQUM5Q3RFLFdBQUFBLENBQVl1RSxFQUFhb0MsR0FBd0IsSUFBdEIsaUJBQUV2QixHQUFrQnVCLEVBQzdDdEIsTUFBTWQsR0FDTmxFLEtBQUtpRixrQkFBb0JGLEVBQ3pCL0UsS0FBSzZILE1BQVE3SCxLQUFLbUUsT0FBT3JELGNBQWMsZUFDekMsQ0FFQXdELElBQUFBLENBQUt3RCxFQUFRQyxHQUNYL0gsS0FBS00sUUFBVXdILEVBQ2Y5SCxLQUFLZ0ksYUFBZUQsRUFDcEIvQyxNQUFNVixNQUNSLENBRUFLLGlCQUFBQSxHQUNFSyxNQUFNTCxvQkFDTjNFLEtBQUs2SCxNQUFNdkcsaUJBQWlCLFVBQVcyRyxJQUNyQ0EsRUFBSW5DLGlCQUNKOUYsS0FBS2lGLGtCQUFrQmpGLEtBQUtNLFFBQVNOLEtBQUtnSSxhQUFhLEdBRTNELEdIaURnRCx3QkFBeUIsQ0FDekVqRCxpQkFBa0JBLENBQUMrQyxFQUFRQyxLQUV6QkEsRUFBWTFFLFNBQ1p1RSxFQUFtQnJELE9BQU8sSUFHOUJxRCxFQUFtQmpELG9CQUduQixNQUFNdUQsRUFBY0MsR0FDTCxJQUFJekksRUFDZnlJLEVBQ0EsaUJBQ0FySSxHQUNBLENBQUNnSSxFQUFRQyxLQUNQSCxFQUFtQnRELEtBQUt3RCxFQUFRQyxFQUFZLElBSXBDbkcsVUFHUndHLEVBQWMsSUk3RkwsTUFDYnpJLFdBQUFBLENBQVcyRyxFQUFzQitCLEdBQW1CLElBQXhDLE1BQUVDLEVBQUssU0FBRUMsR0FBVWpDLEVBQzdCdEcsS0FBS3dJLGVBQWlCRixFQUN0QnRJLEtBQUt5SSxVQUFZRixFQUNqQnZJLEtBQUswSSxXQUFhdkgsU0FBU0wsY0FBY3VILEVBQzNDLENBR0FNLFdBQUFBLEdBQ0UzSSxLQUFLd0ksZUFBZTFFLFNBQVE4RSxJQUMxQjVJLEtBQUt5SSxVQUFVRyxFQUFLLEdBRXhCLENBR0FDLE9BQUFBLENBQVFDLEdBQ045SSxLQUFLMEksV0FBV0ssUUFBUUQsRUFDMUIsR0o0RThCLENBQzlCUixNQUFPdkMsRUFDUHdDLFNBQVdKLElBQ1QsTUFBTUosRUFBY0csRUFBV0MsR0FDL0JDLEVBQVlTLFFBQVFkLEVBQVksR0FFakMsZ0JBRUhLLEVBQVlPLGNBR1osTUFBTUssRUFBb0IsSUFBSWxFLEVBQWMsb0JBQXFCc0MsSUFDL0Q0QixFQUFrQnZELGVBQWMsRUFBTSxhQUV0QyxNQUFNMEMsRUFBVyxDQUFFaEksS0FBTWlILEVBQVNDLE1BQU9oSCxLQUFNK0csRUFBUzZCLE9BR3hELElBQUtkLEVBQVNoSSxLQUFLd0gsU0FBV1EsRUFBUzlILEtBQUtzSCxPQUcxQyxPQUZBdUIsTUFBTSw0REFDTkYsRUFBa0J2RCxlQUFjLEdBSWxDMUIsWUFBVyxLQUNULE1BQU1vRixFQUFVakIsRUFBV0MsR0FDM0JDLEVBQVlTLFFBQVFNLEdBQ3BCSCxFQUFrQnZELGVBQWMsR0FDaEN1RCxFQUFrQnpFLE9BQU8sR0FDeEIsSUFBSyxJQUVWeUUsRUFBa0JyRSxvQkFHbEJ1QixFQUFpQjVFLGlCQUFpQixTQUFTLEtBQ3pDMEgsRUFBa0IxRSxNQUFNLElBSTFCLE1BQU04RSxFQUFrQixJQUFJdEUsRUFBYyxzQkFBdUJzQyxJQUMvRGdDLEVBQWdCM0QsZUFBYyxFQUFNLGFBRXBDLE1BQU00RCxFQUFnQmpDLEVBQVNMLE9BRy9CaEQsWUFBVyxLQUNUc0MsRUFBU1csWUFBWSxDQUFFRCxPQUFRc0MsSUFDL0JELEVBQWdCM0QsZUFBYyxHQUM5QjJELEVBQWdCN0UsT0FBTyxHQUN0QixJQUFLLElBRVY2RSxFQUFnQnpFLG9CQUdoQndCLEVBQWU3RSxpQkFBaUIsU0FBUyxLQUN2QyxNQUFNaUcsRUFBa0JsQixFQUFTUSxjQUNqQzFGLFNBQVNMLGNBQWMsaUJBQWlCeUUsTUFBUWdDLEVBQWdCUixPQUNoRXFDLEVBQWdCOUUsTUFBTSxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcHJhY3RpY3VtL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3ByYWN0aWN1bS93ZWJwYWNrL3J1bnRpbWUvcHVibGljUGF0aCIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvdXRpbHMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Vc2VySW5mby5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Nb2RhbENvbmZpcm1EZWxldGUuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiX193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCIvXCI7IiwiLy8gY29tcG9uZW50cy9DYXJkLmpzXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcbiAgY29uc3RydWN0b3IoZGF0YSwgY2FyZFNlbGVjdG9yLCBoYW5kbGVJbWFnZUNsaWNrLCBoYW5kbGVEZWxldGVDbGljaykge1xuICAgIHRoaXMuX2RhdGEgPSBkYXRhO1xuICAgIHRoaXMuX25hbWUgPSBkYXRhLm5hbWU7XG4gICAgdGhpcy5fbGluayA9IGRhdGEubGluaztcbiAgICB0aGlzLl9jYXJkSWQgPSBkYXRhLl9pZDsgLy8gRW5zdXJlIF9pZCBpcyBwcmVzZW50IGluIGNhcmQgZGF0YVxuICAgIHRoaXMuX2NhcmRTZWxlY3RvciA9IGNhcmRTZWxlY3RvcjtcbiAgICB0aGlzLl9oYW5kbGVJbWFnZUNsaWNrID0gaGFuZGxlSW1hZ2VDbGljaztcbiAgICB0aGlzLl9oYW5kbGVEZWxldGVDbGljayA9IGhhbmRsZURlbGV0ZUNsaWNrOyAvLyBTdG9yZSB0aGUgaGFuZGxlRGVsZXRlQ2xpY2sgY2FsbGJhY2tcblxuICAgIHRoaXMuX2VsZW1lbnQgPSB0aGlzLl9nZXRUZW1wbGF0ZSgpO1xuICAgIHRoaXMuX2xpa2VCdXR0b24gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIik7XG4gICAgdGhpcy5fY2FyZEltYWdlID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuICAgIHRoaXMuX2RlbGV0ZUJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnV0dG9uXCIpO1xuICAgIHRoaXMuX2NhcmRUaXRsZSA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcblxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cblxuICAvLyBNZXRob2QgdG8gY2xvbmUgdGhlIGNhcmQgdGVtcGxhdGVcbiAgX2dldFRlbXBsYXRlKCkge1xuICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZG9jdW1lbnRcbiAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcilcbiAgICAgIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKVxuICAgICAgLmNsb25lTm9kZSh0cnVlKTtcblxuICAgIHJldHVybiBjYXJkRWxlbWVudDtcbiAgfVxuXG4gIC8vIE1ldGhvZCB0byBzZXQgdXAgZXZlbnQgbGlzdGVuZXJzIGZvciB0aGUgY2FyZFxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgLy8gRXZlbnQgbGlzdGVuZXIgZm9yIGltYWdlIGNsaWNrXG4gICAgdGhpcy5fY2FyZEltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLl9oYW5kbGVJbWFnZUNsaWNrKHRoaXMuX25hbWUsIHRoaXMuX2xpbmspO1xuICAgIH0pO1xuXG4gICAgLy8gRXZlbnQgbGlzdGVuZXIgZm9yIGxpa2UgYnV0dG9uIGNsaWNrXG4gICAgdGhpcy5fbGlrZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5faGFuZGxlTGlrZUJ1dHRvbigpO1xuICAgIH0pO1xuXG4gICAgLy8gRXZlbnQgbGlzdGVuZXIgZm9yIGRlbGV0ZSBidXR0b24gY2xpY2tcbiAgICB0aGlzLl9kZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuX2hhbmRsZURlbGV0ZUNsaWNrKHRoaXMuX2NhcmRJZCwgdGhpcy5fZWxlbWVudCk7XG4gICAgfSk7XG5cbiAgICAvLyBIYW5kbGUgYnJva2VuIGltYWdlIFVSTHNcbiAgICB0aGlzLl9jYXJkSW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcihcImVycm9yXCIsICgpID0+IHtcbiAgICAgIHRoaXMuX2NhcmRJbWFnZS5zcmMgPSBcImh0dHBzOi8vcGxhY2VraXR0ZW4uY29tLzQwMC8zMDBcIjsgLy8gRmFsbGJhY2sgaW1hZ2UgVVJMXG4gICAgICB0aGlzLl9jYXJkSW1hZ2UuYWx0ID0gXCJGYWxsYmFjayBpbWFnZVwiO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gTWV0aG9kIHRvIHRvZ2dsZSB0aGUgbGlrZSBidXR0b25cbiAgX2hhbmRsZUxpa2VCdXR0b24oKSB7XG4gICAgdGhpcy5fbGlrZUJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFwibGlrZWRcIik7XG4gIH1cblxuICAvLyBNZXRob2QgdG8gcmVuZGVyIHRoZSBjYXJkXG4gIGdldFZpZXcoKSB7XG4gICAgdGhpcy5fY2FyZEltYWdlLnNyYyA9IHRoaXMuX2xpbms7XG4gICAgdGhpcy5fY2FyZEltYWdlLmFsdCA9IHRoaXMuX25hbWU7XG4gICAgdGhpcy5fY2FyZFRpdGxlLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcbiAgICByZXR1cm4gdGhpcy5fZWxlbWVudDtcbiAgfVxufVxuIiwiLy8gY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcbiAgY29uc3RydWN0b3IoY29uZmlnLCBmb3JtRWxlbWVudCkge1xuICAgIHRoaXMuX2NvbmZpZyA9IGNvbmZpZztcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IGZvcm1FbGVtZW50O1xuICAgIHRoaXMuX2lucHV0TGlzdCA9IEFycmF5LmZyb20odGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9jb25maWcuaW5wdXRTZWxlY3RvcikpO1xuICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG4gIH1cblxuICBfc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50KSB7XG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xuICAgIGlmICghZXJyb3JFbGVtZW50KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBFbGVtZW50IE5vdCBGb3VuZDonLCBgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9jb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2U7XG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fY29uZmlnLmVycm9yQ2xhc3MpO1xuICB9XG5cbiAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcbiAgICBpZiAoIWVycm9yRWxlbWVudCkge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgRWxlbWVudCBOb3QgRm91bmQ6JywgYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gJyc7XG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fY29uZmlnLmVycm9yQ2xhc3MpO1xuICB9XG5cbiAgX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQpIHtcbiAgICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xuICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcbiAgICB9XG4gIH1cblxuICBfaGFzSW52YWxpZElucHV0KCkge1xuICAgIHJldHVybiB0aGlzLl9pbnB1dExpc3Quc29tZShpbnB1dEVsZW1lbnQgPT4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCk7XG4gIH1cblxuICBfdG9nZ2xlQnV0dG9uU3RhdGUoKSB7XG4gICAgaWYgKHRoaXMuX2hhc0ludmFsaWRJbnB1dCgpKSB7XG4gICAgICB0aGlzLl9idXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9jb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgICB0aGlzLl9idXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goaW5wdXRFbGVtZW50ID0+IHtcbiAgICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHtcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCk7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRoaXMuX2Zvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2V0JywgKCkgPT4ge1xuICAgICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goaW5wdXRFbGVtZW50ID0+IHtcbiAgICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcbiAgICAgIH0pO1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgICB9LCAxKTtcbiAgICB9KTtcbiAgfVxuXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxufVxuIiwiLy8gY29tcG9uZW50cy9Qb3B1cC5qc1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgdGhpcy5fcG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xuICAgIHRoaXMuX2hhbmRsZUVzY0Nsb3NlID0gdGhpcy5faGFuZGxlRXNjQ2xvc2UuYmluZCh0aGlzKTsgLy8gQmluZCB0byBlbnN1cmUgYHRoaXNgIHJlZmVyZW5jZXMgdGhlIGNsYXNzXG4gIH1cblxuICAvLyBQdWJsaWMgbWV0aG9kIHRvIG9wZW4gdGhlIHBvcHVwXG4gIG9wZW4oKSB7XG4gICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LmFkZCgnbW9kYWxfb3BlbmVkJyk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTsgLy8gQXR0YWNoIEVzYyBrZXkgZXZlbnRcbiAgfVxuXG4gIC8vIFB1YmxpYyBtZXRob2QgdG8gY2xvc2UgdGhlIHBvcHVwXG4gIGNsb3NlKCkge1xuICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5yZW1vdmUoJ21vZGFsX29wZW5lZCcpO1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7IC8vIERldGFjaCBFc2Mga2V5IGV2ZW50XG4gIH1cblxuICAvLyBQcml2YXRlIG1ldGhvZCB0byBjbG9zZSBwb3B1cCBvbiBFc2Mga2V5IHByZXNzXG4gIF9oYW5kbGVFc2NDbG9zZShldmVudCkge1xuICAgIGlmIChldmVudC5rZXkgPT09ICdFc2NhcGUnKSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICB9XG5cbiAgLy8gUHVibGljIG1ldGhvZCB0byBzZXQgZXZlbnQgbGlzdGVuZXJzIChjbG9zaW5nIG9uIGNsaWNrIGFuZCBjbG9zZSBidXR0b24pXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIC8vIENsb3NlIHRoZSBwb3B1cCB3aGVuIGNsaWNraW5nIG9uIHRoZSBjbG9zZSBidXR0b24gb3Igb3V0c2lkZSB0aGUgZm9ybVxuICAgIHRoaXMuX3BvcHVwLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIChldmVudCkgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICBldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fY2xvc2UnKSB8fFxuICAgICAgICBldmVudC50YXJnZXQgPT09IHRoaXMuX3BvcHVwXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG4iLCIvLyBjb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcbmltcG9ydCBQb3B1cCBmcm9tICcuL1BvcHVwLmpzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3RvciwgaGFuZGxlRm9ybVN1Ym1pdCkge1xuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xuICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQgPSBoYW5kbGVGb3JtU3VibWl0O1xuICAgIHRoaXMuX2Zvcm1FbGVtZW50ID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcignLm1vZGFsX19mb3JtJyk7XG4gICAgdGhpcy5faW5wdXRMaXN0ID0gQXJyYXkuZnJvbSh0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubW9kYWxfX2lucHV0JykpO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbiA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fYnV0dG9uJyk7XG4gICAgdGhpcy5fZGVmYXVsdFN1Ym1pdEJ1dHRvblRleHQgPSB0aGlzLl9zdWJtaXRCdXR0b24udGV4dENvbnRlbnQ7IC8vIFN0b3JlIGRlZmF1bHQgYnV0dG9uIHRleHRcbiAgfVxuXG4gIC8vIFByaXZhdGUgbWV0aG9kIHRvIGNvbGxlY3QgaW5wdXQgdmFsdWVzIGZyb20gYWxsIGZvcm0gZmllbGRzXG4gIF9nZXRJbnB1dFZhbHVlcygpIHtcbiAgICBjb25zdCBmb3JtVmFsdWVzID0ge307XG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICBmb3JtVmFsdWVzW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWU7XG4gICAgfSk7XG4gICAgcmV0dXJuIGZvcm1WYWx1ZXM7XG4gIH1cblxuICAvLyBPdmVycmlkaW5nIHRoZSBvcGVuIG1ldGhvZCB0byByZXNldCB0aGUgZm9ybVxuICBvcGVuKCkge1xuICAgIHN1cGVyLm9wZW4oKTtcbiAgICB0aGlzLl9mb3JtRWxlbWVudC5yZXNldCgpO1xuICB9XG5cbiAgLy8gTWV0aG9kIHRvIHJlbmRlciBsb2FkaW5nIHN0YXRlIGZvciBmb3JtIHN1Ym1pc3Npb25cbiAgcmVuZGVyTG9hZGluZyhpc0xvYWRpbmcsIGxvYWRpbmdUZXh0ID0gJ1NhdmluZy4uLicpIHtcbiAgICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSBsb2FkaW5nVGV4dDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gdGhpcy5fZGVmYXVsdFN1Ym1pdEJ1dHRvblRleHQ7XG4gICAgfVxuICB9XG5cbiAgLy8gT3ZlcnJpZGluZyBzZXRFdmVudExpc3RlbmVycyB0byBhZGQgZm9ybSBzdWJtaXQgaGFuZGxpbmdcbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZXZlbnQpID0+IHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLnJlbmRlckxvYWRpbmcodHJ1ZSk7IC8vIFNob3cgbG9hZGluZyBzdGF0ZSB3aGVuIGZvcm0gaXMgc3VibWl0dGVkXG4gICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KHRoaXMuX2dldElucHV0VmFsdWVzKCkpO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gT3ZlcnJpZGluZyB0aGUgY2xvc2UgbWV0aG9kIHRvIHJlc2V0IGZvcm0gYW5kIHJlbW92ZSBsb2FkaW5nIHN0YXRlXG4gIGNsb3NlKCkge1xuICAgIHN1cGVyLmNsb3NlKCk7XG4gICAgdGhpcy5fZm9ybUVsZW1lbnQucmVzZXQoKTtcbiAgICB0aGlzLnJlbmRlckxvYWRpbmcoZmFsc2UpOyAvLyBSZXNldCBsb2FkaW5nIHN0YXRlIHdoZW4gcG9wdXAgaXMgY2xvc2VkXG4gIH1cbn1cbiIsIi8vIHV0aWxzL2NvbnN0YW50cy5qc1xuZXhwb3J0IGNvbnN0IGluaXRpYWxDYXJkcyA9IFtcbiAge1xuICAgIF9pZDogJzEnLFxuICAgIG5hbWU6ICdZb3NlbWl0ZSBWYWxsZXknLFxuICAgIGxpbms6IHJlcXVpcmUoJy4uL2ltYWdlcy95b3NlbWl0ZS5qcGcnKSxcbiAgfSxcbiAge1xuICAgIF9pZDogJzInLFxuICAgIG5hbWU6ICdMYWtlIExvdWlzZScsXG4gICAgbGluazogcmVxdWlyZSgnLi4vaW1hZ2VzL2xha2UtbG91aXNlLmpwZycpLFxuICB9LFxuICB7XG4gICAgX2lkOiAnMycsXG4gICAgbmFtZTogJ0JhbGQgTW91bnRhaW5zJyxcbiAgICBsaW5rOiByZXF1aXJlKCcuLi9pbWFnZXMvYmFsZC1tb3VudGFpbnMuanBnJyksXG4gIH0sXG4gIHtcbiAgICBfaWQ6ICc0JyxcbiAgICBuYW1lOiAnTGF0ZW1hcicsXG4gICAgbGluazogcmVxdWlyZSgnLi4vaW1hZ2VzL2xhdGVtYXIuanBnJyksXG4gIH0sXG4gIHtcbiAgICBfaWQ6ICc1JyxcbiAgICBuYW1lOiAnVmFub2lzZSBOYXRpb25hbCBQYXJrJyxcbiAgICBsaW5rOiByZXF1aXJlKCcuLi9pbWFnZXMvdmFub2lzZS5qcGcnKSxcbiAgfSxcbiAge1xuICAgIF9pZDogJzYnLFxuICAgIG5hbWU6ICdMYWdvIGRpIEJyYWllcycsXG4gICAgbGluazogcmVxdWlyZSgnLi4vaW1hZ2VzL2xhZ28uanBnJyksXG4gIH0sXG5dO1xuXG5leHBvcnQgY29uc3Qgc2V0dGluZ3MgPSB7XG4gIGlucHV0U2VsZWN0b3I6ICcubW9kYWxfX2lucHV0JyxcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6ICcubW9kYWxfX2J1dHRvbicsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6ICdtb2RhbF9fYnV0dG9uX2Rpc2FibGVkJyxcbiAgaW5wdXRFcnJvckNsYXNzOiAnbW9kYWxfX2lucHV0X3R5cGVfZXJyb3InLFxuICBlcnJvckNsYXNzOiAnbW9kYWxfX2Vycm9yX3Zpc2libGUnLFxufTtcbiIsIi8vIGluZGV4LmpzXG5pbXBvcnQgQ2FyZCBmcm9tICcuLi9jb21wb25lbnRzL0NhcmQuanMnO1xuaW1wb3J0IEZvcm1WYWxpZGF0b3IgZnJvbSAnLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzJztcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tICcuLi9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzJztcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gJy4uL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyc7XG5pbXBvcnQgTW9kYWxDb25maXJtRGVsZXRlIGZyb20gJy4uL2NvbXBvbmVudHMvTW9kYWxDb25maXJtRGVsZXRlLmpzJztcbmltcG9ydCBVc2VySW5mbyBmcm9tICcuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzJztcbmltcG9ydCBTZWN0aW9uIGZyb20gJy4uL2NvbXBvbmVudHMvU2VjdGlvbi5qcyc7XG5pbXBvcnQgeyBpbml0aWFsQ2FyZHMsIHNldHRpbmdzIH0gZnJvbSAnLi4vdXRpbHMvY29uc3RhbnRzLmpzJztcbmltcG9ydCAnLi4vcGFnZXMvaW5kZXguY3NzJztcblxuLy8gV3JhcHBlcnMgYW5kIEVsZW1lbnRzXG5jb25zdCBjYXJkc1dyYXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZHNfX2xpc3QnKTtcbmNvbnN0IHByb2ZpbGVFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Byb2ZpbGVfX2VkaXQtYnV0dG9uJyk7XG5jb25zdCBhZGROZXdDYXJkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2FkZC1idXR0b24nKTtcbmNvbnN0IGF2YXRhckVkaXRJY29uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2F2YXRhci1jb250YWluZXInKTtcblxuLy8gRm9ybSBFbGVtZW50c1xuY29uc3QgcHJvZmlsZUVkaXRGb3JtID0gZG9jdW1lbnQuZm9ybXNbJ3Byb2ZpbGUtZm9ybSddO1xuY29uc3QgYWRkQ2FyZEZvcm1FbGVtZW50ID0gZG9jdW1lbnQuZm9ybXNbJ2NhcmQtZm9ybSddO1xuY29uc3QgYXZhdGFyRWRpdEZvcm1FbGVtZW50ID0gZG9jdW1lbnQuZm9ybXNbJ2F2YXRhci1mb3JtJ107XG5cbi8vIEVuYWJsZSBWYWxpZGF0aW9uIGZvciBGb3Jtc1xuY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChjb25maWcpID0+IHtcbiAgY29uc3QgZm9ybUxpc3QgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2Zvcm0nKSk7XG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbGVtZW50KSA9PiB7XG4gICAgY29uc3QgdmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoY29uZmlnLCBmb3JtRWxlbWVudCk7XG4gICAgdmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcbiAgfSk7XG59O1xuXG5lbmFibGVWYWxpZGF0aW9uKHNldHRpbmdzKTtcblxuLy8gQ3JlYXRlIGFuIGluc3RhbmNlIG9mIFVzZXJJbmZvXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyh7XG4gIG5hbWVTZWxlY3RvcjogJyNwcm9maWxlLXRpdGxlJyxcbiAgam9iU2VsZWN0b3I6ICcjcHJvZmlsZS1kZXNjcmlwdGlvbicsXG4gIGF2YXRhclNlbGVjdG9yOiAnLnByb2ZpbGVfX2ltYWdlJ1xufSk7XG5cbi8vIENyZWF0ZSBhbiBpbnN0YW5jZSBvZiBQb3B1cFdpdGhGb3JtIGZvciB0aGUgcHJvZmlsZSBlZGl0IGZvcm1cbmNvbnN0IHByb2ZpbGVGb3JtUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybSgnI3Byb2ZpbGUtZWRpdC1tb2RhbCcsIChmb3JtRGF0YSkgPT4ge1xuICBwcm9maWxlRm9ybVBvcHVwLnJlbmRlckxvYWRpbmcodHJ1ZSwgJ1NhdmluZy4uLicpOyAvLyBTaG93IFwiU2F2aW5nLi4uXCIgdGV4dFxuICBcbiAgLy8gU2ltdWxhdGUgYW4gQVBJIHJlcXVlc3Qgb3IgYWRkIHlvdXIgYWN0dWFsIEFQSSByZXF1ZXN0IGhlcmVcbiAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgdXNlckluZm8uc2V0VXNlckluZm8oeyBuYW1lOiBmb3JtRGF0YS50aXRsZSwgam9iOiBmb3JtRGF0YS5kZXNjcmlwdGlvbiB9KTtcbiAgICBwcm9maWxlRm9ybVBvcHVwLnJlbmRlckxvYWRpbmcoZmFsc2UpOyAvLyBSZXNldCBidXR0b24gdGV4dFxuICAgIHByb2ZpbGVGb3JtUG9wdXAuY2xvc2UoKTsgIC8vIENsb3NlIHRoZSBwb3B1cCBhZnRlciBzdWJtaXNzaW9uXG4gIH0sIDIwMDApOyAvLyBTaW11bGF0ZWQgZGVsYXkgdG8gZGVtb25zdHJhdGUgbG9hZGluZyBzdGF0ZVxufSk7XG5wcm9maWxlRm9ybVBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbi8vIEhhbmRsZSBvcGVuaW5nIHRoZSBwcm9maWxlIGVkaXQgcG9wdXAgd2l0aCBwcmUtZmlsbGVkIGN1cnJlbnQgdXNlciBkYXRhXG5wcm9maWxlRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgY29uc3QgY3VycmVudFVzZXJJbmZvID0gdXNlckluZm8uZ2V0VXNlckluZm8oKTtcbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Byb2ZpbGUtdGl0bGUtaW5wdXQnKS52YWx1ZSA9IGN1cnJlbnRVc2VySW5mby5uYW1lO1xuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcHJvZmlsZS1kZXNjcmlwdGlvbi1pbnB1dCcpLnZhbHVlID0gY3VycmVudFVzZXJJbmZvLmpvYjtcbiAgcHJvZmlsZUZvcm1Qb3B1cC5vcGVuKCk7XG59KTtcblxuLy8gQ3JlYXRlIGFuIGluc3RhbmNlIG9mIFBvcHVwV2l0aEltYWdlIGZvciB0aGUgaW1hZ2UgcG9wdXBcbmNvbnN0IGltYWdlUG9wdXAgPSBuZXcgUG9wdXBXaXRoSW1hZ2UoJyNpbWFnZS1wcmV2aWV3LW1vZGFsJyk7XG5pbWFnZVBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbi8vIEhhbmRsZSBpbWFnZSBjbGljayB0byBvcGVuIHRoZSBpbWFnZSBwb3B1cFxuY29uc3QgaGFuZGxlSW1hZ2VDbGljayA9IChuYW1lLCBsaW5rKSA9PiB7XG4gIGltYWdlUG9wdXAub3Blbih7IG5hbWUsIGxpbmsgfSk7XG59O1xuXG4vLyBJbml0aWFsaXplIHRoZSBkZWxldGUgY29uZmlybWF0aW9uIG1vZGFsXG5jb25zdCBtb2RhbENvbmZpcm1EZWxldGUgPSBuZXcgTW9kYWxDb25maXJtRGVsZXRlKCcjY29uZmlybS1kZWxldGUtbW9kYWwnLCB7XG4gIGhhbmRsZUZvcm1TdWJtaXQ6IChjYXJkSWQsIGNhcmRFbGVtZW50KSA9PiB7XG4gICAgLy8gUGVyZm9ybSBkZWxldGlvbiBsb2dpYyBoZXJlIChlLmcuLCBBUEkgY2FsbClcbiAgICBjYXJkRWxlbWVudC5yZW1vdmUoKTtcbiAgICBtb2RhbENvbmZpcm1EZWxldGUuY2xvc2UoKTtcbiAgfSxcbn0pO1xubW9kYWxDb25maXJtRGVsZXRlLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbi8vIENyZWF0ZSBhbmQgcmVuZGVyIGNhcmRzXG5jb25zdCBjcmVhdGVDYXJkID0gKGNhcmREYXRhKSA9PiB7XG4gIGNvbnN0IGNhcmQgPSBuZXcgQ2FyZChcbiAgICBjYXJkRGF0YSxcbiAgICAnI2NhcmQtdGVtcGxhdGUnLFxuICAgIGhhbmRsZUltYWdlQ2xpY2ssXG4gICAgKGNhcmRJZCwgY2FyZEVsZW1lbnQpID0+IHtcbiAgICAgIG1vZGFsQ29uZmlybURlbGV0ZS5vcGVuKGNhcmRJZCwgY2FyZEVsZW1lbnQpO1xuICAgIH1cbiAgKTtcblxuICByZXR1cm4gY2FyZC5nZXRWaWV3KCk7XG59O1xuXG5jb25zdCBjYXJkU2VjdGlvbiA9IG5ldyBTZWN0aW9uKHtcbiAgaXRlbXM6IGluaXRpYWxDYXJkcyxcbiAgcmVuZGVyZXI6IChjYXJkRGF0YSkgPT4ge1xuICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gY3JlYXRlQ2FyZChjYXJkRGF0YSk7XG4gICAgY2FyZFNlY3Rpb24uYWRkSXRlbShjYXJkRWxlbWVudCk7XG4gIH1cbn0sICcuY2FyZHNfX2xpc3QnKTtcblxuY2FyZFNlY3Rpb24ucmVuZGVySXRlbXMoKTtcblxuLy8gQ3JlYXRlIGFuIGluc3RhbmNlIG9mIFBvcHVwV2l0aEZvcm0gZm9yIHRoZSBhZGQgY2FyZCBmb3JtXG5jb25zdCBhZGRQbGFjZUZvcm1Qb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKCcjYWRkLXBsYWNlLW1vZGFsJywgKGZvcm1EYXRhKSA9PiB7XG4gIGFkZFBsYWNlRm9ybVBvcHVwLnJlbmRlckxvYWRpbmcodHJ1ZSwgJ1NhdmluZy4uLicpOyAvLyBTaG93IFwiU2F2aW5nLi4uXCIgdGV4dFxuXG4gIGNvbnN0IGNhcmREYXRhID0geyBuYW1lOiBmb3JtRGF0YS50aXRsZSwgbGluazogZm9ybURhdGEuaW1hZ2UgfTtcblxuICAvLyBQcmV2ZW50IGFkZGluZyBhIGNhcmQgaWYgdGhlIGZpZWxkcyBhcmUgZW1wdHkgb3IgaW52YWxpZFxuICBpZiAoIWNhcmREYXRhLm5hbWUudHJpbSgpIHx8ICFjYXJkRGF0YS5saW5rLnRyaW0oKSkge1xuICAgIGFsZXJ0KCdQbGVhc2UgZmlsbCBvdXQgYm90aCB0aGUgbmFtZSBhbmQgaW1hZ2UgVVJMIGZpZWxkcy4nKTtcbiAgICBhZGRQbGFjZUZvcm1Qb3B1cC5yZW5kZXJMb2FkaW5nKGZhbHNlKTsgLy8gUmVzZXQgYnV0dG9uIHRleHQgaW4gY2FzZSBvZiB2YWxpZGF0aW9uIGVycm9yXG4gICAgcmV0dXJuO1xuICB9XG5cbiAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgY29uc3QgbmV3Q2FyZCA9IGNyZWF0ZUNhcmQoY2FyZERhdGEpO1xuICAgIGNhcmRTZWN0aW9uLmFkZEl0ZW0obmV3Q2FyZCk7XG4gICAgYWRkUGxhY2VGb3JtUG9wdXAucmVuZGVyTG9hZGluZyhmYWxzZSk7IC8vIFJlc2V0IGJ1dHRvbiB0ZXh0XG4gICAgYWRkUGxhY2VGb3JtUG9wdXAuY2xvc2UoKTsgIC8vIENsb3NlIHRoZSBwb3B1cCBhZnRlciBzdWJtaXNzaW9uXG4gIH0sIDIwMDApOyAvLyBTaW11bGF0ZWQgZGVsYXkgdG8gZGVtb25zdHJhdGUgbG9hZGluZyBzdGF0ZVxufSk7XG5hZGRQbGFjZUZvcm1Qb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vLyBIYW5kbGUgb3BlbmluZyB0aGUgYWRkIGNhcmQgcG9wdXBcbmFkZE5ld0NhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gIGFkZFBsYWNlRm9ybVBvcHVwLm9wZW4oKTtcbn0pO1xuXG4vLyBDcmVhdGUgYW4gaW5zdGFuY2Ugb2YgUG9wdXBXaXRoRm9ybSBmb3IgdGhlIGF2YXRhciBlZGl0IGZvcm1cbmNvbnN0IGF2YXRhckZvcm1Qb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKCcjYXZhdGFyLWVkaXQtbW9kYWwnLCAoZm9ybURhdGEpID0+IHtcbiAgYXZhdGFyRm9ybVBvcHVwLnJlbmRlckxvYWRpbmcodHJ1ZSwgJ1NhdmluZy4uLicpOyAvLyBTaG93IFwiU2F2aW5nLi4uXCIgdGV4dFxuXG4gIGNvbnN0IG5ld0F2YXRhckxpbmsgPSBmb3JtRGF0YS5hdmF0YXI7XG5cbiAgLy8gU2ltdWxhdGUgYW4gQVBJIHJlcXVlc3Qgb3IgYWRkIHlvdXIgYWN0dWFsIEFQSSByZXF1ZXN0IGhlcmVcbiAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgdXNlckluZm8uc2V0VXNlckluZm8oeyBhdmF0YXI6IG5ld0F2YXRhckxpbmsgfSk7XG4gICAgYXZhdGFyRm9ybVBvcHVwLnJlbmRlckxvYWRpbmcoZmFsc2UpOyAvLyBSZXNldCBidXR0b24gdGV4dFxuICAgIGF2YXRhckZvcm1Qb3B1cC5jbG9zZSgpOyAgLy8gQ2xvc2UgdGhlIHBvcHVwIGFmdGVyIHN1Ym1pc3Npb25cbiAgfSwgMjAwMCk7IC8vIFNpbXVsYXRlZCBkZWxheSB0byBkZW1vbnN0cmF0ZSBsb2FkaW5nIHN0YXRlXG59KTtcbmF2YXRhckZvcm1Qb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vLyBIYW5kbGUgb3BlbmluZyB0aGUgYXZhdGFyIGVkaXQgcG9wdXBcbmF2YXRhckVkaXRJY29uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICBjb25zdCBjdXJyZW50VXNlckluZm8gPSB1c2VySW5mby5nZXRVc2VySW5mbygpO1xuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjYXZhdGFyLWlucHV0JykudmFsdWUgPSBjdXJyZW50VXNlckluZm8uYXZhdGFyOyAvLyBQcmUtZmlsbCB3aXRoIHRoZSBjdXJyZW50IGF2YXRhciBVUkxcbiAgYXZhdGFyRm9ybVBvcHVwLm9wZW4oKTtcbn0pO1xuIiwiLy8gY29tcG9uZW50cy9Vc2VySW5mby5qc1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckluZm8ge1xuICBjb25zdHJ1Y3Rvcih7IG5hbWVTZWxlY3Rvciwgam9iU2VsZWN0b3IsIGF2YXRhclNlbGVjdG9yIH0pIHtcbiAgICB0aGlzLl9uYW1lRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IobmFtZVNlbGVjdG9yKTtcbiAgICB0aGlzLl9qb2JFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihqb2JTZWxlY3Rvcik7XG4gICAgdGhpcy5fYXZhdGFyRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYXZhdGFyU2VsZWN0b3IpO1xuICB9XG5cbiAgLy8gTWV0aG9kIHRvIGdldCB0aGUgY3VycmVudCB1c2VyIGluZm8gZnJvbSB0aGUgcGFnZVxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogdGhpcy5fbmFtZUVsZW1lbnQudGV4dENvbnRlbnQsXG4gICAgICBqb2I6IHRoaXMuX2pvYkVsZW1lbnQudGV4dENvbnRlbnQsXG4gICAgICBhdmF0YXI6IHRoaXMuX2F2YXRhckVsZW1lbnQuc3JjLFxuICAgIH07XG4gIH1cblxuICAvLyBNZXRob2QgdG8gc2V0IG5ldyB1c2VyIGluZm8gb24gdGhlIHBhZ2VcbiAgc2V0VXNlckluZm8oeyBuYW1lLCBqb2IsIGF2YXRhciB9KSB7XG4gICAgaWYgKG5hbWUpIHRoaXMuX25hbWVFbGVtZW50LnRleHRDb250ZW50ID0gbmFtZTtcbiAgICBpZiAoam9iKSB0aGlzLl9qb2JFbGVtZW50LnRleHRDb250ZW50ID0gam9iO1xuXG4gICAgaWYgKGF2YXRhcikge1xuICAgICAgLy8gU2V0IHVwIHRoZSBhdmF0YXIgaW1hZ2Ugd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcgZm9yIGJyb2tlbiBsaW5rc1xuICAgICAgdGhpcy5fYXZhdGFyRWxlbWVudC5zcmMgPSBhdmF0YXI7XG4gICAgICB0aGlzLl9hdmF0YXJFbGVtZW50LmFsdCA9IGBBdmF0YXIgb2YgJHtuYW1lIHx8IHRoaXMuX25hbWVFbGVtZW50LnRleHRDb250ZW50fWA7XG5cbiAgICAgIC8vIEVycm9yIGhhbmRsaW5nIHRvIGxvYWQgYSBmYWxsYmFjayBpbWFnZSBpZiB0aGUgcHJvdmlkZWQgYXZhdGFyIGZhaWxzIHRvIGxvYWRcbiAgICAgIHRoaXMuX2F2YXRhckVsZW1lbnQub25lcnJvciA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5fYXZhdGFyRWxlbWVudC5zcmMgPSAnaHR0cHM6Ly9wbGFjZWtpdHRlbi5jb20vMTUwLzE1MCc7IC8vIEZhbGxiYWNrIGltYWdlIGZvciBhdmF0YXJcbiAgICAgICAgdGhpcy5fYXZhdGFyRWxlbWVudC5hbHQgPSAnRmFsbGJhY2sgYXZhdGFyIGltYWdlJztcbiAgICAgIH07XG4gICAgfVxuICB9XG59XG4iLCIvLyBjb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzXG5pbXBvcnQgUG9wdXAgZnJvbSAnLi9Qb3B1cC5qcyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgdGhpcy5faW1hZ2VFbGVtZW50ID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcignLm1vZGFsX19pbWFnZScpO1xuICAgIHRoaXMuX2NhcHRpb25FbGVtZW50ID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcignLm1vZGFsX19jYXB0aW9uJyk7XG4gIH1cblxuICAvLyBPdmVycmlkaW5nIHRoZSBvcGVuIG1ldGhvZCB0byBhY2NlcHQgZGF0YSBhbmQgc2V0IGltYWdlIGFuZCBjYXB0aW9uXG4gIG9wZW4oeyBuYW1lLCBsaW5rIH0pIHtcbiAgICBpZiAoIWxpbmsudHJpbSgpIHx8ICFuYW1lLnRyaW0oKSkge1xuICAgICAgY29uc29sZS5lcnJvcignSW52YWxpZCBpbWFnZSBkYXRhOiBtaXNzaW5nIG5hbWUgb3IgbGluaycpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuX2ltYWdlRWxlbWVudC5zcmMgPSBsaW5rO1xuICAgIHRoaXMuX2ltYWdlRWxlbWVudC5hbHQgPSBgSW1hZ2Ugb2YgJHtuYW1lfWA7XG4gICAgdGhpcy5fY2FwdGlvbkVsZW1lbnQudGV4dENvbnRlbnQgPSBuYW1lO1xuICAgIHN1cGVyLm9wZW4oKTsgLy8gQ2FsbCB0aGUgcGFyZW50IGNsYXNzIG9wZW4gbWV0aG9kXG4gIH1cbn1cbiIsIi8vIGNvbXBvbmVudHMvTW9kYWxDb25maXJtRGVsZXRlLmpzXG5pbXBvcnQgUG9wdXAgZnJvbSAnLi9Qb3B1cC5qcyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vZGFsQ29uZmlybURlbGV0ZSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3RvciwgeyBoYW5kbGVGb3JtU3VibWl0IH0pIHtcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcbiAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ID0gaGFuZGxlRm9ybVN1Ym1pdDtcbiAgICB0aGlzLl9mb3JtID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcignLm1vZGFsX19mb3JtJyk7XG4gIH1cblxuICBvcGVuKGNhcmRJZCwgY2FyZEVsZW1lbnQpIHtcbiAgICB0aGlzLl9jYXJkSWQgPSBjYXJkSWQ7XG4gICAgdGhpcy5fY2FyZEVsZW1lbnQgPSBjYXJkRWxlbWVudDtcbiAgICBzdXBlci5vcGVuKCk7XG4gIH1cblxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgKGV2dCkgPT4ge1xuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KHRoaXMuX2NhcmRJZCwgdGhpcy5fY2FyZEVsZW1lbnQpO1xuICAgIH0pO1xuICB9XG59XG4iLCIvLyBjb21wb25lbnRzL1NlY3Rpb24uanNcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xuICBjb25zdHJ1Y3Rvcih7IGl0ZW1zLCByZW5kZXJlciB9LCBjb250YWluZXJTZWxlY3Rvcikge1xuICAgIHRoaXMuX3JlbmRlcmVkSXRlbXMgPSBpdGVtcztcbiAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyU2VsZWN0b3IpO1xuICB9XG5cbiAgLy8gTWV0aG9kIHRvIHJlbmRlciBhbGwgaXRlbXMgb24gdGhlIHBhZ2VcbiAgcmVuZGVySXRlbXMoKSB7XG4gICAgdGhpcy5fcmVuZGVyZWRJdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgdGhpcy5fcmVuZGVyZXIoaXRlbSk7ICAvLyBDYWxsIHRoZSByZW5kZXJlciBmdW5jdGlvbiBmb3IgZWFjaCBpdGVtXG4gICAgfSk7XG4gIH1cblxuICAvLyBNZXRob2QgdG8gYWRkIGEgc2luZ2xlIGNhcmQgZWxlbWVudCB0byB0aGUgY29udGFpbmVyXG4gIGFkZEl0ZW0oZWxlbWVudCkge1xuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGVsZW1lbnQpO1xuICB9XG59XG4iXSwibmFtZXMiOlsiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwidW5kZWZpbmVkIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJwIiwiQ2FyZCIsImNvbnN0cnVjdG9yIiwiZGF0YSIsImNhcmRTZWxlY3RvciIsImhhbmRsZUltYWdlQ2xpY2siLCJoYW5kbGVEZWxldGVDbGljayIsInRoaXMiLCJfZGF0YSIsIl9uYW1lIiwibmFtZSIsIl9saW5rIiwibGluayIsIl9jYXJkSWQiLCJfaWQiLCJfY2FyZFNlbGVjdG9yIiwiX2hhbmRsZUltYWdlQ2xpY2siLCJfaGFuZGxlRGVsZXRlQ2xpY2siLCJfZWxlbWVudCIsIl9nZXRUZW1wbGF0ZSIsIl9saWtlQnV0dG9uIiwicXVlcnlTZWxlY3RvciIsIl9jYXJkSW1hZ2UiLCJfZGVsZXRlQnV0dG9uIiwiX2NhcmRUaXRsZSIsIl9zZXRFdmVudExpc3RlbmVycyIsImRvY3VtZW50IiwiY29udGVudCIsImNsb25lTm9kZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJfaGFuZGxlTGlrZUJ1dHRvbiIsInNyYyIsImFsdCIsImNsYXNzTGlzdCIsInRvZ2dsZSIsImdldFZpZXciLCJ0ZXh0Q29udGVudCIsIkZvcm1WYWxpZGF0b3IiLCJjb25maWciLCJmb3JtRWxlbWVudCIsIl9jb25maWciLCJfZm9ybUVsZW1lbnQiLCJfaW5wdXRMaXN0IiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImlucHV0U2VsZWN0b3IiLCJfYnV0dG9uRWxlbWVudCIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiX3Nob3dJbnB1dEVycm9yIiwiaW5wdXRFbGVtZW50IiwiZXJyb3JFbGVtZW50IiwiaWQiLCJhZGQiLCJpbnB1dEVycm9yQ2xhc3MiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImVycm9yQ2xhc3MiLCJjb25zb2xlIiwiZXJyb3IiLCJfaGlkZUlucHV0RXJyb3IiLCJyZW1vdmUiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwidmFsaWRpdHkiLCJ2YWxpZCIsIl9oYXNJbnZhbGlkSW5wdXQiLCJzb21lIiwiX3RvZ2dsZUJ1dHRvblN0YXRlIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImRpc2FibGVkIiwiZm9yRWFjaCIsInNldFRpbWVvdXQiLCJlbmFibGVWYWxpZGF0aW9uIiwiUG9wdXAiLCJwb3B1cFNlbGVjdG9yIiwiX3BvcHVwIiwiX2hhbmRsZUVzY0Nsb3NlIiwiYmluZCIsIm9wZW4iLCJjbG9zZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJldmVudCIsImtleSIsInNldEV2ZW50TGlzdGVuZXJzIiwidGFyZ2V0IiwiY29udGFpbnMiLCJQb3B1cFdpdGhGb3JtIiwiaGFuZGxlRm9ybVN1Ym1pdCIsInN1cGVyIiwiX2hhbmRsZUZvcm1TdWJtaXQiLCJfc3VibWl0QnV0dG9uIiwiX2RlZmF1bHRTdWJtaXRCdXR0b25UZXh0IiwiX2dldElucHV0VmFsdWVzIiwiZm9ybVZhbHVlcyIsImlucHV0IiwidmFsdWUiLCJyZXNldCIsInJlbmRlckxvYWRpbmciLCJpc0xvYWRpbmciLCJsb2FkaW5nVGV4dCIsImFyZ3VtZW50cyIsImxlbmd0aCIsInByZXZlbnREZWZhdWx0IiwiaW5pdGlhbENhcmRzIiwicmVxdWlyZSIsInByb2ZpbGVFZGl0QnV0dG9uIiwiYWRkTmV3Q2FyZEJ1dHRvbiIsImF2YXRhckVkaXRJY29uIiwiZm9ybXMiLCJ1c2VySW5mbyIsIl9yZWYiLCJuYW1lU2VsZWN0b3IiLCJqb2JTZWxlY3RvciIsImF2YXRhclNlbGVjdG9yIiwiX25hbWVFbGVtZW50IiwiX2pvYkVsZW1lbnQiLCJfYXZhdGFyRWxlbWVudCIsImdldFVzZXJJbmZvIiwiam9iIiwiYXZhdGFyIiwic2V0VXNlckluZm8iLCJfcmVmMiIsIm9uZXJyb3IiLCJwcm9maWxlRm9ybVBvcHVwIiwiZm9ybURhdGEiLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwiY3VycmVudFVzZXJJbmZvIiwiaW1hZ2VQb3B1cCIsIl9pbWFnZUVsZW1lbnQiLCJfY2FwdGlvbkVsZW1lbnQiLCJ0cmltIiwibW9kYWxDb25maXJtRGVsZXRlIiwiX2Zvcm0iLCJjYXJkSWQiLCJjYXJkRWxlbWVudCIsIl9jYXJkRWxlbWVudCIsImV2dCIsImNyZWF0ZUNhcmQiLCJjYXJkRGF0YSIsImNhcmRTZWN0aW9uIiwiY29udGFpbmVyU2VsZWN0b3IiLCJpdGVtcyIsInJlbmRlcmVyIiwiX3JlbmRlcmVkSXRlbXMiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwicmVuZGVySXRlbXMiLCJpdGVtIiwiYWRkSXRlbSIsImVsZW1lbnQiLCJwcmVwZW5kIiwiYWRkUGxhY2VGb3JtUG9wdXAiLCJpbWFnZSIsImFsZXJ0IiwibmV3Q2FyZCIsImF2YXRhckZvcm1Qb3B1cCIsIm5ld0F2YXRhckxpbmsiXSwic291cmNlUm9vdCI6IiJ9